<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gest√£o de Jogos - Team Pro Stats</title>
  <style>
    :root {
      --primary-color: #0077ff;
      --bg-color: #f4f7fa;
      --card-bg: #fff;
      --text-color: #333;
      --border-color: #ddd;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      margin: 0;
      padding: 0;
    }

    header {
      background-color: var(--primary-color);
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
    }

    main {
      max-width: 900px;
      margin: 2rem auto;
      background-color: var(--card-bg);
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
    }

    input, select {
      padding: 0.5rem;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 1rem;
    }

    label {
      font-weight: bold;
    }

    button {
      padding: 0.7rem 1rem;
      border: none;
      border-radius: 8px;
      background-color: var(--primary-color);
      color: white;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background-color: #005fcc;
    }

    .actions {
      margin-top: 1rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .notification {
      margin-top: 1rem;
      font-weight: bold;
      display: none;
    }

    table {
      width: 100%;
      margin-top: 1rem;
      border-collapse: collapse;
    }

    th, td {
      padding: 0.5rem;
      border: 1px solid #ccc;
      text-align: left;
    }

    th {
      background-color: #f0f0f0;
    }

    #gamesList {
      display: none;
      opacity: 0;
      transition: opacity 0.3s;
    }
  </style>
</head>
<body>
  <header>‚öΩ Gest√£o de Jogos - Team Pro Stats</header>

  <main>
    <form id="jogoForm">
      <label>Escal√£o</label>
      <input type="text" id="escalao" name="escalao" />

      <label>Competi√ß√£o</label>
      <input type="text" id="competicao" name="competicao" />

      <label>Fase</label>
      <input type="text" id="fase" name="fase" />

      <label>Grupo</label>
      <input type="text" id="grupo" name="grupo" />

      <label>Jornada</label>
      <input type="text" id="jornada" name="jornada" />

      <label>Data</label>
      <input type="date" id="data" name="data" />

      <label>Hora</label>
      <input type="time" id="hora" name="hora" />

      <label>Local</label>
      <input type="text" id="local" name="local" />

      <label>Advers√°rio</label>
      <input type="text" id="adversario" name="adversario" />
    </form>

    <div class="actions">
      <button onclick="newGame()">Novo Jogo</button>
      <button id="saveButton" onclick="saveCurrentGame()" disabled>Salvar</button>
      <button onclick="showGamesList()">Mostrar Jogos</button>
      <button onclick="deleteAllGames()">Apagar Todos</button>
    </div>

    <div id="notification" class="notification"></div>

    <div id="gamesList">
      <h3>üìã Jogos Guardados</h3>
      <table>
        <thead>
          <tr>
            <th>Escal√£o</th>
            <th>Competi√ß√£o</th>
            <th>Fase</th>
            <th>Grupo</th>
            <th>Jornada</th>
            <th>Data/Hora</th>
            <th>Local</th>
            <th>Advers√°rio</th>
            <th>Ativo</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="gamesTableBody"></tbody>
      </table>
    </div>
  </main>

  <!-- Firebase + App Script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc } 
      from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // ‚úÖ Your Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyCD8a60aGbdXdYFKKKrV-z0mCDZx9yKWqI",
      authDomain: "team-pro-stats.firebaseapp.com",
      projectId: "team-pro-stats",
      storageBucket: "team-pro-stats.firebasestorage.app",
      messagingSenderId: "758444286089",
      appId: "1:758444286089:web:fcd8fba3a5d705de01e658",
      measurementId: "G-D1GDDBPD55"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // --------------- APP LOGIC ----------------
    let games = [];
    let currentGameId = null;
    const STORAGE_KEY_CURRENT_FORM = "current_game_form";
    let jogoForm, notification, saveButton;

    function showNotification(msg, error = false) {
      notification.textContent = msg;
      notification.style.color = error ? "#e74c3c" : "var(--primary-color)";
      notification.style.display = "block";
      setTimeout(() => (notification.style.display = "none"), 3000);
    }

    function getFormData() {
      const data = {};
      for (const el of jogoForm.elements) {
        if (el.name) data[el.name] = el.value || "";
      }
      return data;
    }

    async function newGame() {
      jogoForm.reset();
      const newGame = {
        escalao: "",
        competicao: "",
        fase: "",
        grupo: "",
        jornada: "",
        data: "",
        hora: "",
        local: "",
        adversario: "",
        active: true,
        createdAt: new Date().toISOString()
      };
      const docRef = await addDoc(collection(db, "games"), newGame);
      currentGameId = docRef.id;
      saveButton.disabled = false;
      showNotification("üÜï Novo jogo criado!");
      await loadGames();
    }

    async function saveCurrentGame() {
      if (!currentGameId) return;
      const data = getFormData();
      data.active = true;
      const gameRef = doc(db, "games", currentGameId);
      await updateDoc(gameRef, data);
      showNotification("üíæ Jogo salvo no Firebase!");
      await loadGames();
    }

    async function loadGames() {
      games = [];
      const querySnapshot = await getDocs(collection(db, "games"));
      querySnapshot.forEach((docSnap) => {
        games.push({ id: docSnap.id, ...docSnap.data() });
      });
      renderGamesList();
    }

    async function loadGameToForm(gameId) {
      const game = games.find(g => g.id === gameId);
      if (!game) return;
      Object.entries(game).forEach(([key, val]) => {
        const input = document.getElementById(key);
        if (input) input.value = val;
      });
      currentGameId = gameId;
      saveButton.disabled = false;

      for (const g of games) {
        g.active = (g.id === gameId);
        await updateDoc(doc(db, "games", g.id), { active: g.active });
      }

      showNotification("‚úÖ Jogo carregado!");
      renderGamesList();
    }

    async function deleteGame(gameId) {
      await deleteDoc(doc(db, "games", gameId));
      showNotification("üóëÔ∏è Jogo apagado!");
      await loadGames();
    }

    async function deleteAllGames() {
      if (!confirm("Tem certeza que deseja excluir todos os jogos?")) return;
      const querySnapshot = await getDocs(collection(db, "games"));
      for (const docSnap of querySnapshot.docs) {
        await deleteDoc(docSnap.ref);
      }
      showNotification("üßπ Todos os jogos apagados!");
      await loadGames();
    }

    function renderGamesList() {
      const tbody = document.getElementById("gamesTableBody");
      tbody.innerHTML = "";
      if (games.length === 0) {
        tbody.innerHTML = `<tr><td colspan="10" style="text-align:center;">Nenhum jogo salvo.</td></tr>`;
        return;
      }
      for (const g of games) {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${g.escalao || ""}</td>
          <td>${g.competicao || ""}</td>
          <td>${g.fase || ""}</td>
          <td>${g.grupo || ""}</td>
          <td>${g.jornada || ""}</td>
          <td>${g.data || ""} ${g.hora || ""}</td>
          <td>${g.local || ""}</td>
          <td>${g.adversario || ""}</td>
          <td>${g.active ? "‚úÖ" : ""}</td>
          <td>
            <button class="load-btn" onclick="loadGameToForm('${g.id}')">Load</button>
            <button onclick="deleteGame('${g.id}')">Delete</button>
          </td>`;
        tbody.appendChild(tr);
      }
    }

    window.newGame = newGame;
    window.saveCurrentGame = saveCurrentGame;
    window.loadGameToForm = loadGameToForm;
    window.deleteGame = deleteGame;
    window.deleteAllGames = deleteAllGames;
    window.showGamesList = async () => {
      const div = document.getElementById("gamesList");
      if (div.style.display === "block") {
        div.style.opacity = 0;
        setTimeout(() => (div.style.display = "none"), 300);
      } else {
        await loadGames();
        div.style.display = "block";
        div.style.opacity = 1;
      }
    };

    window.onload = async function () {
      jogoForm = document.getElementById("jogoForm");
      notification = document.getElementById("notification");
      saveButton = document.getElementById("saveButton");

      jogoForm.addEventListener("input", () => {
        const data = getFormData();
        localStorage.setItem(STORAGE_KEY_CURRENT_FORM, JSON.stringify(data));
      });

      const savedForm = localStorage.getItem(STORAGE_KEY_CURRENT_FORM);
      if (savedForm) {
        const formData = JSON.parse(savedForm);
        Object.entries(formData).forEach(([k, v]) => {
          const input = document.getElementById(k);
          if (input) input.value = v;
        });
        showNotification("‚úÖ Dados restaurados do cache local!");
      }

      await loadGames();
    };
  </script>
</body>
</html>

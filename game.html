<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Estatísticas do Jogo</title>
<style>
body { font-family:"Segoe UI",Tahoma,sans-serif; background:#f4f4f4; margin:0; padding:20px; color:#333; }
.container { max-width:1200px; margin:0 auto; background:#fff; padding:25px; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,.1);}
h2 { text-align:center; color:#2980b9; }
.section { margin-bottom:25px; }
.button-group { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:15px; }
button { padding:10px 20px; font-size:16px; border:none; border-radius:5px; cursor:pointer; color:#fff; }
.btn-stat { background:#2980b9; } .btn-stat:hover { background:#3498db; }
#gameInfo { background:#f0f8ff; padding:15px; border-radius:5px; }
#gameList { margin-top:15px; }
.game-item { display:flex; justify-content:space-between; align-items:center; background:#f9f9f9; padding:8px 12px; border-radius:5px; margin-bottom:5px; }
.game-item button { margin-left:5px; padding:5px 10px; font-size:14px; border-radius:3px; }
.notification { display:none; position:fixed; right:12px; top:12px; background:#e0ffe0; padding:8px 12px; border-radius:6px; box-shadow:0 2px 6px rgba(0,0,0,0.15); }
.notification.error { background:#ffdede; }
</style>
</head>
<body>
<div class="container">
  <h2>Estatísticas do Jogo</h2>

  <div id="gameInfo" class="section">
    <strong>Jogo Ativo:</strong>
    <div id="activeGameDetails">Carregando informações do jogo...</div>
  </div>

  <div class="button-group section">
    <button style="background:#27ae60" id="backConfigBtn">Configurar Jogo</button>
    <button style="background:#2980b9" id="listGamesBtn">Listar Jogos</button>
    <button style="background:#27ae60" id="newGameBtn">Novo Jogo</button>
  </div>

  <div class="section" id="gameListContainer" style="display:none;">
    <h3>Jogos Salvos</h3>
    <div id="gameList">Carregando...</div>
  </div>
</div>

<div id="notification" class="notification"></div>

<script type="module">
import { ensureAuth, getAllGameIds, deleteFirebaseData, setActiveGame, activeGameId, getActiveGameData } from './firebase-data.js';

const gameListContainer = document.getElementById('gameListContainer');
const gameListEl = document.getElementById('gameList');
const activeGameDetails = document.getElementById('activeGameDetails');
const notificationEl = document.getElementById('notification');

function showNotification(msg, isError=false) {
  notificationEl.textContent = msg;
  notificationEl.className = isError ? 'notification error' : 'notification';
  notificationEl.style.display='block';
  setTimeout(()=>notificationEl.style.display='none',2000);
}

async function renderGames() {
  try {
    const games = await getAllGameIds();
    gameListEl.innerHTML='';
    if (!games || games.length === 0) { gameListEl.innerHTML='Nenhum jogo encontrado.'; return; }
    for (const g of games) {
      const div = document.createElement('div'); div.className='game-item';
      div.innerHTML=`<div><strong>${g.data.adversario||'Sem Adversário'}</strong> (${g.data.competicao||'N/A'}) - ${g.data.data||'N/A'}</div>`;
      const btnLoad = document.createElement('button'); btnLoad.textContent='Carregar'; btnLoad.style.background='#27ae60';
      btnLoad.onclick=async()=>{ await setActiveGame(g.id); loadActiveGame(); };
      const btnDel = document.createElement('button'); btnDel.textContent='Eliminar'; btnDel.style.background='#e74c3c';
      btnDel.onclick=async()=>{ 
        if(confirm('Eliminar este jogo?')) { await deleteFirebaseData(["users", (await ensureAuth()), "games", g.id]); showNotification("Jogo eliminado"); renderGames(); } 
      };
      div.appendChild(btnLoad); div.appendChild(btnDel);
      gameListEl.appendChild(div);
    }
  } catch(e) { console.error(e); showNotification("Erro ao listar jogos", true); }
}

async function loadActiveGame() {
  const data = await getActiveGameData();
  if (!data) { activeGameDetails.innerHTML='Sem jogo ativo'; return; }
  activeGameDetails.innerHTML=`
    <div><strong>Escalão:</strong> ${data.escalao||'-'}</div>
    <div><strong>Competição:</strong> ${data.competicao||'-'}</div>
    <div><strong>Fase:</strong> ${data.fase||'-'}</div>
    <div><strong>Grupo:</strong> ${data.grupo||'-'}</div>
    <div><strong>Jornada:</strong> ${data.jornada||'-'}</div>
    <div><strong>Data / Hora:</strong> ${data.data||'-'} ${data.hora||'-'}</div>
    <div><strong>Local:</strong> ${data.local||'-'}</div>
    <div><strong>Adversário:</strong> ${data.adversario||'-'}</div>
  `;
}

document.getElementById('listGamesBtn').onclick=()=>{ gameListContainer.style.display='block'; renderGames(); }
document.getElementById('backConfigBtn').onclick=()=>{ window.location.href='configjogoequipa.html'; }
document.getElementById('newGameBtn').onclick=()=>{ window.location.href='configjogoequipa.html'; }

ensureAuth().then(loadActiveGame).catch(e=>console.error(e));
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tabela PSE</title>
<style>
  html, body {
    height: 100%;
    margin: 0;
    font-family: "Segoe UI", Tahoma, sans-serif;
    background: #f5f5f5;
    color: #333;
  }
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
    box-sizing: border-box;
  }

  .container {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    max-width: 1400px;
    padding: 10px;
    box-sizing: border-box;
  }

  h1 {
    font-size: 2rem;
    margin-bottom: 15px;
    text-align: center;
  }

  .responsive {
    margin-bottom: 25px;
    padding: 15px;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    width: 100%;
    overflow-x: auto;
  }

  table.part-table {
    border-collapse: collapse;
    width: 100%;
    table-layout: auto;
    min-width: 0;
  }

  table.part-table th,
  table.part-table td {
    border: 1px solid #eee;
    padding: 8px;
    font-size: 0.9rem;
    text-align: center;
    white-space: normal;
  }

  table.part-table th {
    background: #2980b9;
    color: #fff;
    font-weight: 600;
  }

  table.part-table tr:nth-child(even) {
    background: #f9f9f9;
  }

  td.emoji {
    font-size: 1rem;
    font-weight: bold;
    border-radius: 4px;
    color: white;
  }

  button {
    padding: 4px 8px;
    font-size: 0.8rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
    margin: 0 2px;
  }

  .btn-save { background: #4CAF50; color: white; }
  .btn-save:hover { background: #45a049; transform: translateY(-1px); }
  .btn-clear { background: #f44336; color: white; }
  .btn-clear:hover { background: #e53935; transform: translateY(-1px); }

  footer {
    width: 100%;
    text-align: center;
    padding: 12px 0;
    font-size: 0.8em;
    color: #666;
    font-family: Tahoma, sans-serif;
  }

  @media (max-width: 992px) {
    table.part-table th, table.part-table td { font-size: 0.85rem; padding: 6px; }
  }
  @media (max-width: 768px) {
    h1 { font-size: 1.5rem; }
    table.part-table th, table.part-table td { font-size: 0.8rem; padding: 5px; }
  }
  @media (max-width: 480px) {
    h1 { font-size: 1.3rem; }
    table.part-table th, table.part-table td { font-size: 0.75rem; padding: 4px; }
  }
</style>
</head>
<body>

<div class="container">
  <h1>Tabela de Dados PSE</h1>

  <div class="responsive">
    <table id="pseTable" class="part-table">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
const pseDescriptions = {
  1:'Muito leve', 2:'Leve', 3:'Leve', 4:'Moderado', 5:'Moderado', 6:'Moderado',
  7:'Vigoroso', 8:'Vigoroso', 9:'Muito dif√≠cil', 10:'Esfor√ßo m√°ximo'
};

const pseColors = {
  1:'#6699FF', 2:'#ADD8E6', 3:'#ADD8E6', 4:'#4CAF50', 5:'#4CAF50', 6:'#4CAF50',
  7:'#FFD700', 8:'#FFD700', 9:'#FFA500', 10:'#FF0000'
};

const pseEmojis = {
  1:'üò¥', 2:'üôÇ', 3:'üôÇ', 4:'üòê', 5:'üòê', 6:'üòê',
  7:'üòÖ', 8:'üòÖ', 9:'üò´', 10:'üíÄ'
};

function getPseColor(value) {
  return pseColors[value] || '#ffffff';
}

function loadTable() {
  const pseData = JSON.parse(localStorage.getItem("pseData")) || [];
  const table = document.getElementById("pseTable");

  if(!pseData.length){
    table.innerHTML = "<tr><td colspan='4'>Nenhum dado registado.</td></tr>";
    return;
  }

  pseData.sort((a,b)=>a.name.localeCompare(b.name));

  let thead = `<tr>
    <th>Atleta</th>
    <th>PSE</th>
    <th>Data/Hora</th>
    <th>A√ß√µes</th>
  </tr>`;

  let tbody = pseData.map((item, index)=>{
    const date = new Date(item.datetime);
    const color = getPseColor(item.pse);
    const emoji = pseEmojis[item.pse];
    return `<tr>
      <td>${item.name}</td>
      <td class="emoji" id="pse-${index}" style="background:${color}">${emoji} ${item.pse}</td>
      <td>${date.toLocaleString('pt-BR', { dateStyle:'short', timeStyle:'short' })}</td>
      <td>
        <button class="btn-save" id="btn-${index}" onclick="editEntry(${index})">Editar</button>
        <button class="btn-clear" onclick="deleteEntry(${index})">Apagar</button>
      </td>
    </tr>`;
  }).join('');

  table.querySelector('thead').innerHTML = thead;
  table.querySelector('tbody').innerHTML = tbody;
}

function editEntry(index) {
  const pseData = JSON.parse(localStorage.getItem("pseData")) || [];
  const cell = document.getElementById(`pse-${index}`);
  const btn = document.getElementById(`btn-${index}`);

  const currentValue = pseData[index].pse;
  cell.innerHTML = `<input type="number" min="1" max="10" value="${currentValue}" class="pse-input" style="width:50px;text-align:center;">`;
  const input = cell.querySelector('input');
  input.focus();

  btn.textContent = "Salvar";
  btn.onclick = () => saveEntry(index, input.value);

  input.addEventListener('keydown', (e) => {
    if(e.key === "Enter") saveEntry(index, input.value);
    if(e.key === "Escape") loadTable();
  });
}

function saveEntry(index, value) {
  const pseData = JSON.parse(localStorage.getItem("pseData")) || [];
  const val = parseInt(value);
  if(isNaN(val) || val < 1 || val > 10) { alert("Valor inv√°lido!"); return; }
  pseData[index].pse = val;
  pseData[index].desc = pseDescriptions[val]; // optional, kept internally
  localStorage.setItem("pseData", JSON.stringify(pseData));
  loadTable();
}

function deleteEntry(index) {
  if(!confirm("Apagar este registo?")) return;
  const pseData = JSON.parse(localStorage.getItem("pseData")) || [];
  pseData.splice(index,1);
  localStorage.setItem("pseData", JSON.stringify(pseData));
  loadTable();
}

loadTable();
</script>

<footer>¬© 2025 Team Pro Stats ¬∑ Powered by RP Technology</footer>
</body>
</html>

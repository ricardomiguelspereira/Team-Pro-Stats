<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Upload Logo da Equipa</title>
<style>
  body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #f4f4f4; margin: 0; padding: 20px; color: #333; }
  #content-wrapper { max-width: 600px; margin: 0 auto; background: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; }
  h1 { font-size: 24px; font-weight: bold; margin-bottom: 25px; color: #2980b9; }
  .input-group { margin-bottom: 20px; }
  input[type="file"] { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; }
  #teamLogoPreview { max-width: 100%; height: auto; max-height: 200px; margin-top: 20px; border: 1px solid #eee; border-radius: 8px; display: none; }
  button { padding: 10px 20px; background: #27ae60; color: #fff; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; margin-top: 20px; transition: background 0.3s ease; }
  button:hover { background: #219150; }
  #notification {
    margin-top: 20px; padding: 10px; border-radius: 5px; text-align: center;
    background: rgba(52, 152, 219, 0.1); color: #2980b9; display: none; opacity: 1; transition: opacity 0.3s ease;
  }
  #notification.error { background: rgba(231, 76, 60, 0.1); color: #e74c3c; }
  #notification.show { display: block; }
  footer { text-align: center; padding: 15px 0; font-size: 0.8em; color: #666; margin-top: 30px; }
</style>
</head>
<body>

<div id="content-wrapper">
  <div id="content">
    <h1>Upload Logo da Equipa</h1>

    <div class="input-group">
      <input type="file" id="teamLogoInput" accept="image/*">
    </div>

    <div>
      <img id="teamLogoPreview" src="" alt="Logo da Equipa">
    </div>

    <button id="saveBtn">Guardar</button>
    <div id="notification"></div>
  </div>
</div>

<footer>© 2025 Team Pro Stats · Powered by RP Technology</footer>

<script type="module" src="firebase-data.js"></script>
<script>
import {
  FB_PATHS_GLOBAL,
  initializeFirebase,
  setFirebaseData,
  getFirebaseData
} from './firebase-data.js';

document.addEventListener('DOMContentLoaded', async () => {
  await initializeFirebase(); // Ensures auth & migration

  const input = document.getElementById('teamLogoInput');
  const preview = document.getElementById('teamLogoPreview');
  const saveBtn = document.getElementById('saveBtn');
  const notification = document.getElementById('notification');

  function showNotification(message, isError = false) {
    notification.textContent = message;
    notification.className = isError ? 'notification error show' : 'notification show';
    setTimeout(() => notification.classList.remove('show'), 2000);
  }

  let savedData = await getFirebaseData(FB_PATHS_GLOBAL.teamLogo) || {};
  if(savedData.logo){
    preview.src = savedData.logo;
    preview.style.display = 'block';
  }

  let logoBase64 = savedData.logo || '';

  input.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if(file){
      const reader = new FileReader();
      reader.onload = (ev) => {
        logoBase64 = ev.target.result;
        preview.src = logoBase64;
        preview.style.display = 'block';
      };
      reader.readAsDataURL(file);
    }
  });

  saveBtn.addEventListener('click', async () => {
    if(!logoBase64){
      showNotification('❌ Nenhum logo selecionado!', true);
      return;
    }
    savedData.logo = logoBase64;
    await setFirebaseData(FB_PATHS_GLOBAL.teamLogo, savedData);
    showNotification('✅ Logo guardado com sucesso!');
  });
});
</script>

</body>
</html>